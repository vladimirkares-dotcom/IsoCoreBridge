<?xml version="1.0" encoding="UTF-8" ?>
<views:MenuPage
    x:Class="IsoCore.App.Views.UsersPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:views="using:IsoCore.App.Views"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:viewModels="using:IsoCore.App.ViewModels"
    xmlns:conv="using:Microsoft.UI.Xaml"
    mc:Ignorable="d">

    <Grid Background="{StaticResource IcbdWindowBackgroundBrush}"
          Style="{StaticResource IcbdPageGrid}"
          ColumnSpacing="{StaticResource IcbdSpacingMedium}"
          RowSpacing="{StaticResource IcbdSpacingMedium}">
        <Grid.RowDefinitions>
            <RowDefinition Height="Auto" />
            <RowDefinition Height="*" />
        </Grid.RowDefinitions>
        <Grid.ColumnDefinitions>
            <ColumnDefinition Width="2*" />
            <ColumnDefinition Width="3*" />
        </Grid.ColumnDefinitions>

        <!-- Header -->
        <StackPanel Grid.Row="0"
                    Grid.ColumnSpan="2"
                    Orientation="Vertical"
                    Margin="{StaticResource IcbdPaddingL}">
            <TextBlock Text="Uživatelé"
                       Style="{StaticResource IcbdHeadlineXLTextBlockStyle}" />
        </StackPanel>

        <ScrollViewer Grid.Row="1"
                      Grid.ColumnSpan="2"
                      VerticalScrollBarVisibility="Auto">
            <Grid ColumnDefinitions="2*,3*"
                  RowDefinitions="Auto,Auto"
                  ColumnSpacing="{StaticResource IcbdSpacingMedium}"
                  RowSpacing="{StaticResource IcbdSpacingMedium}"
                  Margin="{StaticResource IcbdPaddingL}">
                <!-- Top-left: user actions -->
                <Border Grid.Row="0"
                        Grid.Column="0"
                        Style="{StaticResource IcbdDashboardCardBaseStyle}"
                        Padding="{StaticResource IcbdPaddingL}">
                    <StackPanel Spacing="{StaticResource IcbdSpacingMedium}">
                        <TextBlock Text="Akce uživatele"
                                   Style="{StaticResource IcbdSubheaderText}" />
                        <StackPanel Orientation="Vertical"
                                    Spacing="{StaticResource IcbdSpacingSmall}"
                                    HorizontalAlignment="Stretch">
                            <Button Content="Založit uživatele"
                                    Command="{Binding NewUserCommand}"
                                    Click="NewUserActionButton_Click"
                                    Style="{StaticResource IcbdPrimaryButton}"
                                    HorizontalAlignment="Stretch" />
                            <Button Content="Editovat uživatele"
                                    Click="EditUserActionButton_Click"
                                    Style="{StaticResource IcbdButtonSecondaryStyle}"
                                    HorizontalAlignment="Stretch" />
                            <Button Content="Smazat uživatele"
                                    Click="DeleteUser_Click"
                                    Style="{StaticResource IcbdButtonSecondaryStyle}"
                                    HorizontalAlignment="Stretch" />
                            <Button Content="Aktivovat / deaktivovat"
                                    Click="ToggleActiveButton_Click"
                                    Style="{StaticResource IcbdButtonSecondaryStyle}"
                                    HorizontalAlignment="Stretch" />
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Top-right: users list -->
                <Border Grid.Row="0"
                        Grid.Column="1"
                        Style="{StaticResource IcbdDashboardCardBaseStyle}"
                        Padding="{StaticResource IcbdPaddingL}">
                    <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                        <TextBlock Text="Uživatelé"
                                   Style="{StaticResource IcbdSectionHeaderText}" />
                        <StackPanel Spacing="4">
                            <Grid ColumnDefinitions="1*,1*,1*,1*"
                                  Padding="0,0,0,4">
                                <TextBlock Text="Jméno" Style="{StaticResource IcbdListHeaderTextStyle}" />
                                <TextBlock Text="Příjmení" Grid.Column="1" Style="{StaticResource IcbdListHeaderTextStyle}" />
                                <TextBlock Text="Role" Grid.Column="2" Style="{StaticResource IcbdListHeaderTextStyle}" />
                                <TextBlock Text="Stav" Grid.Column="3" Style="{StaticResource IcbdListHeaderTextStyle}" />
                            </Grid>
                            <ListView ItemsSource="{Binding Users}"
                                      SelectedItem="{Binding SelectedUser, Mode=TwoWay}">
                                <ListView.ItemTemplate>
                                    <DataTemplate x:DataType="viewModels:UserListItem">
                                        <Grid ColumnDefinitions="1*,1*,1*,1*">
                                            <TextBlock Text="{x:Bind FirstName}" />
                                            <TextBlock Text="{x:Bind LastName}" Grid.Column="1" />
                                            <TextBlock Text="{x:Bind RoleDisplayName}" Grid.Column="2" />
                                            <TextBlock Text="{x:Bind Status}" Grid.Column="3" />
                                        </Grid>
                                    </DataTemplate>
                                </ListView.ItemTemplate>
                            </ListView>
                        </StackPanel>
                    </StackPanel>
                </Border>

                <!-- Bottom-left: placeholder for recent changes -->
                <Border Grid.Row="1"
                        Grid.Column="0"
                        Style="{StaticResource IcbdDashboardCardBaseStyle}"
                        Padding="{StaticResource IcbdPaddingL}">
                    <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                        <TextBlock Text="Poslední změny"
                                   Style="{StaticResource IcbdSectionHeaderText}" />
                        <TextBlock Text="{Binding LastChangeMessage}"
                                   Style="{StaticResource IcbdBodyTextBlockStyle}" />
                    </StackPanel>
                </Border>

                <!-- Bottom-right: user detail form -->
                <Border Grid.Row="1"
                        Grid.Column="1"
                        Style="{StaticResource IcbdDashboardCardBaseStyle}"
                        Padding="{StaticResource IcbdPaddingL}">
                    <Grid>
                        <StackPanel Spacing="{StaticResource IcbdSpacingSmall}"
                                    Visibility="{Binding UserSummaryVisibility}">
                            <TextBlock Text="Uživatelé"
                                       Style="{StaticResource IcbdSectionHeaderText}" />
                            <TextBlock Style="{StaticResource IcbdBodyTextBlockStyle}">
                                <Run Text="Celkem uživatelů: " />
                                <Run Text="{Binding Users.Count}" />
                            </TextBlock>
                            <TextBlock Style="{StaticResource IcbdBodyTextBlockStyle}">
                                <Run Text="Aktivní: " />
                                <Run Text="{Binding ActiveUsers}" />
                                <Run Text=" · Neaktivní: " />
                                <Run Text="{Binding InactiveUsers}" />
                            </TextBlock>
                            <TextBlock Style="{StaticResource IcbdBodyTextBlockStyle}">
                                <Run Text="Kmen: " />
                                <Run Text="{Binding CoreEmployees}" />
                                <Run Text=" · Subdodavatel: " />
                                <Run Text="{Binding Subcontractors}" />
                            </TextBlock>
                            <StackPanel Orientation="Vertical">
                                <TextBlock Text="Role" Style="{StaticResource IcbdCaptionText}" />
                                <TextBlock Style="{StaticResource IcbdBodyTextBlockStyle}">
                                    <Run Text="Admin: " />
                                    <Run Text="{Binding AdminCount}" />
                                    <Run Text=" · Mistr: " />
                                    <Run Text="{Binding MistrCount}" />
                                </TextBlock>
                                <TextBlock Style="{StaticResource IcbdBodyTextBlockStyle}">
                                    <Run Text="Kontrolor: " />
                                    <Run Text="{Binding KontrolorCount}" />
                                    <Run Text=" · Technik: " />
                                    <Run Text="{Binding TechnikCount}" />
                                </TextBlock>
                                <TextBlock Style="{StaticResource IcbdBodyTextBlockStyle}">
                                    <Run Text="Předák: " />
                                    <Run Text="{Binding PredakCount}" />
                                    <Run Text=" · Dělník: " />
                                    <Run Text="{Binding DelnikCount}" />
                                </TextBlock>
                            </StackPanel>
                            <TextBlock Text="Vyberte uživatele ze seznamu pro detail."
                                       Style="{StaticResource IcbdBodyTextBlockStyle}" />
                        </StackPanel>

                        <StackPanel Spacing="{StaticResource IcbdSpacingSmall}"
                                    Visibility="{Binding UserDetailVisibility}">
                            <TextBlock Text="Detail uživatele"
                                       Style="{StaticResource IcbdSectionHeaderText}" />

                            <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Uživatelské jméno"
                                               Style="{StaticResource IcbdCaptionText}" />
                                    <TextBlock Text="{Binding EditUsername}"
                                               Style="{StaticResource IcbdBodyTextBlockStyle}" />
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Zobrazované jméno"
                                               Style="{StaticResource IcbdCaptionText}" />
                                    <TextBlock Text="{Binding EditDisplayName}"
                                               Style="{StaticResource IcbdBodyTextBlockStyle}" />
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Role"
                                               Style="{StaticResource IcbdCaptionText}" />
                                    <TextBlock Text="{Binding EditRole}"
                                               Style="{StaticResource IcbdBodyTextBlockStyle}" />
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Číslo pracovníka"
                                               Style="{StaticResource IcbdCaptionText}" />
                                    <TextBlock Text="{Binding EditWorkerNumber}"
                                               Style="{StaticResource IcbdBodyTextBlockStyle}" />
                                </StackPanel>
                                <StackPanel Spacing="2">
                                    <TextBlock Text="Aktivní"
                                               Style="{StaticResource IcbdCaptionText}" />
                                    <CheckBox IsChecked="{Binding EditIsActive}"
                                              IsEnabled="False" />
                                </StackPanel>
                                <TextBlock Text="{Binding UserFormError}"
                                           TextWrapping="Wrap"
                                           Margin="0,4,0,0" />
                                <!-- Hidden password fields kept for code-behind compatibility -->
                                <PasswordBox x:Name="NewPasswordBox"
                                             Visibility="Collapsed" />
                                <PasswordBox x:Name="ConfirmPasswordBox"
                                             Visibility="Collapsed" />
                            </StackPanel>
                        </StackPanel>
                    </Grid>
                </Border>
            </Grid>
        </ScrollViewer>
    </Grid>
</views:MenuPage>




