<?xml version="1.0" encoding="utf-8"?>
<views:MenuPage
    x:Class="IsoCore.App.Views.ProjectDetailPage"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:views="using:IsoCore.App.Views"
    xmlns:converters="using:IsoCore.App.Converters"
    xmlns:domain="using:IsoCore.Domain"
    mc:Ignorable="d">

    <views:MenuPage.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="ms-appx:///Styles/DetailPageStyles.xaml" />
            </ResourceDictionary.MergedDictionaries>
            <converters:BooleanToVisibilityConverter x:Key="BooleanToVisibilityConverter" />
        </ResourceDictionary>
    </views:MenuPage.Resources>

    <Grid Background="{StaticResource IcbdWindowBackgroundBrush}"
          Style="{StaticResource IcbdPageGrid}">
        <ScrollViewer VerticalScrollBarVisibility="Auto">
            <Border Style="{StaticResource IcbdDashboardCardBaseStyle}"
                    Padding="{StaticResource IcbdPaddingL}">
                <StackPanel Spacing="{StaticResource IcbdSpacingMedium}">
                <Grid ColumnDefinitions="*,Auto"
                      ColumnSpacing="{StaticResource IcbdSpacingSmall}">
                    <StackPanel Grid.Column="0"
                                Orientation="Vertical"
                                Spacing="{StaticResource IcbdSpacingSmall}">
                        <TextBlock Text="{Binding ProjectDisplayName, FallbackValue='Detail projektu'}"
                                   Style="{StaticResource IcbdSectionHeaderText}" />
                        <TextBlock Text="{Binding StatusText, FallbackValue='Stav: ?'}"
                                   Style="{StaticResource DetailHeaderStatusText}" />
                    </StackPanel>

                    <StackPanel Grid.Column="1"
                                Style="{StaticResource DetailHeaderActionsPanel}">
                        <StackPanel Orientation="Vertical"
                                    Style="{StaticResource DetailHeaderDatePanel}" Spacing="{StaticResource IcbdSpacingSmall}">
                            <TextBlock Style="{StaticResource DetailHeaderDateText}">
                                <Run Text="Vytvořeno: " />
                                <Run Text="{Binding CreatedAtText, FallbackValue='—'}" />
                            </TextBlock>
                            <TextBlock Style="{StaticResource DetailHeaderDateText}">
                                <Run Text="Poslední změna: " />
                                <Run Text="{Binding UpdatedAtText, FallbackValue='—'}" />
                            </TextBlock>
                        </StackPanel>
                        <Button Content="Zpět"
                                Style="{StaticResource DetailBackButton}"
                                Click="OnBackButtonClicked" />
                    </StackPanel>
                </Grid>

                <TextBlock Text="Základní informace"
                           Style="{StaticResource DetailSectionHeader}" />

                <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                    <StackPanel Orientation="Horizontal"
                                Spacing="{StaticResource IcbdSpacingMedium}">
                        <TextBlock Text="Název projektu:"
                                   Style="{StaticResource IcbdBodyTextBlockStyle}" />
                        <TextBlock Text="{Binding ProjectName, FallbackValue='—'}"
                                   Style="{StaticResource IcbdBodyTextBlockStyle}" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal"
                                Spacing="{StaticResource IcbdSpacingMedium}">
                        <TextBlock Text="Kód projektu:"
                                   Style="{StaticResource IcbdBodyTextBlockStyle}" />
                        <TextBlock Text="{Binding ProjectCode, FallbackValue='—'}"
                                   Style="{StaticResource IcbdBodyTextBlockStyle}" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal"
                                Spacing="{StaticResource IcbdSpacingMedium}">
                        <TextBlock Text="Popis:"
                                   Style="{StaticResource IcbdBodyTextBlockStyle}" />
                        <TextBlock Text="{Binding ProjectDescription, FallbackValue='—'}"
                                   Style="{StaticResource WrappingTextBlock}" />
                    </StackPanel>

                    <StackPanel Orientation="Horizontal"
                                Spacing="{StaticResource IcbdSpacingMedium}">
                        <TextBlock Text="Stav:"
                                   Style="{StaticResource IcbdBodyTextBlockStyle}" />
                        <TextBlock Text="{Binding ProjectStatusText, FallbackValue='—'}"
                                   Style="{StaticResource IcbdBodyTextBlockStyle}" />
                    </StackPanel>
                </StackPanel>

                                                                                
                
                
                <ScrollViewer VerticalScrollBarVisibility="Auto">
                    <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                        <Grid Style="{StaticResource SectionContentTopMarginGrid}" ColumnSpacing="{StaticResource IcbdSpacingLarge}">
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="2*" />
                                <ColumnDefinition Width="*" />
                            </Grid.ColumnDefinitions>

                            <Border Grid.Column="0"
                                    Style="{StaticResource IcbdDashboardCardBaseStyle}"
                                    Padding="{StaticResource IcbdPaddingL}">
                                <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                                    <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                                        <TextBlock Text="Stavební objekty"
                                                   Style="{StaticResource IcbdSectionHeaderText}" />
                                        <StackPanel Orientation="Horizontal"
                                                    Spacing="{StaticResource IcbdSpacingSmall}">
                                            <Button Content="Nový"
                                                    Click="OnNewBuildingObjectButtonClick" />
                                            <Button Content="Upravit"
                                                    Command="{Binding EditBuildingObjectCommand}"
                                                    Click="OnEditBuildingObjectButtonClick" />
                                            <Button Content="Smazat"
                                                    Command="{Binding DeleteBuildingObjectCommand}" />
                                        </StackPanel>
                                        <Grid>
                                            <ListView ItemsSource="{Binding BuildingObjects}"
                                                      SelectedItem="{Binding SelectedBuildingObject, Mode=TwoWay}"
                                                      IsItemClickEnabled="False">
                                                <ListView.ItemTemplate>
                                                    <DataTemplate>
                                                        <StackPanel Style="{StaticResource BuildingObjectListItemPanel}">
                                                            <TextBlock Text="{Binding Code}"
                                                                       Style="{StaticResource BuildingObjectListCodeText}" />
                                                            <TextBlock Text="{Binding Name}"
                                                                       Style="{StaticResource BuildingObjectListNameText}" />
                                                        </StackPanel>
                                                    </DataTemplate>
                                                </ListView.ItemTemplate>
                                            </ListView>
                                            <TextBlock Text="Zatím nejsou založeny žádné stavební objekty."
                                                       Style="{StaticResource EmptyListPlaceholderText}"
                                                       Visibility="{Binding HasNoBuildingObjects, Converter={StaticResource BooleanToVisibilityConverter}}" />
                                        </Grid>
                                    </StackPanel>
                                </StackPanel>
                            </Border>

                            <Border Grid.Column="1"
                                    Style="{StaticResource IcbdDashboardCardBaseStyle}"
                                    Padding="{StaticResource IcbdPaddingL}">
                                <Grid>
                                    <StackPanel Visibility="{Binding HasNoSelectedBuildingObject, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <TextBlock Text="Přehled stavebních objektů" Style="{StaticResource IcbdSubheaderText}" />
                                        <TextBlock Text="{Binding TotalBuildingObjects, FallbackValue='-'}" Style="{StaticResource IcbdBodyTextBlockStyle}" />
                                        <TextBlock Text="Celková plocha: -" Style="{StaticResource IcbdBodyTextBlockStyle}" />
                                        <TextBlock Text="Vyberte stavební objekt vlevo pro zobrazení detailu."
                                                   Style="{StaticResource WrappingTextBlock}" />
                                    </StackPanel>

                                    <Grid Visibility="{Binding HasSelectedBuildingObject, Converter={StaticResource BooleanToVisibilityConverter}}">
                                        <Grid.RowDefinitions>
                                            <RowDefinition Height="*" />
                                        </Grid.RowDefinitions>

                                        <!-- Read-only detail -->
                                        <StackPanel Spacing="{StaticResource IcbdSpacingMedium}"
                                                    Visibility="{Binding IsNotEditing, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                                                <TextBlock Text="Detail stavebního objektu" Style="{StaticResource IcbdSubheaderText}" />
                                                <TextBlock Text="{Binding SelectedBuildingObject.Code, FallbackValue='SO ?'}" Style="{StaticResource BuildingObjectDetailCodeText}" />
                                                <TextBlock Text="{Binding SelectedBuildingObject.Name, FallbackValue='(bez názvu)'}" Style="{StaticResource BuildingObjectDetailNameText}" />

                                                <Grid ColumnSpacing="{StaticResource IcbdSpacingMedium}"
                                                      RowSpacing="{StaticResource IcbdSpacingSmall}">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                    </Grid.RowDefinitions>

                                                    <TextBlock Text="Typ konstrukce:"
                                                               Grid.Row="0"
                                                               Grid.Column="0" />
                                                    <TextBlock Text="{Binding SelectedBuildingObject.StructureType}"
                                                               Grid.Row="0"
                                                               Grid.Column="1" />

                                                    <TextBlock Text="Krytí:"
                                                               Grid.Row="1"
                                                               Grid.Column="0" />
                                                    <TextBlock Text="{Binding SelectedBuildingObject.CoverType}"
                                                               Grid.Row="1"
                                                               Grid.Column="1" />

                                                    <TextBlock Text="Stav:"
                                                               Grid.Row="2"
                                                               Grid.Column="0" />
                                                    <TextBlock Text="{Binding SelectedBuildingObject.Status}"
                                                               Grid.Row="2"
                                                               Grid.Column="1" />
                                                </Grid>
                                            </StackPanel>

                                            <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                                                <TextBlock Text="Izolace a technologie" Style="{StaticResource IcbdSubheaderText}" />
                                                <Grid ColumnSpacing="{StaticResource IcbdSpacingMedium}"
                                                      RowSpacing="{StaticResource IcbdSpacingSmall}">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                    </Grid.RowDefinitions>

                                                    <TextBlock Text="Příprava:"
                                                               Grid.Row="0"
                                                               Grid.Column="0" />
                                                    <TextBlock Text="{Binding SelectedBuildingObject.PrepType}"
                                                               Grid.Row="0"
                                                               Grid.Column="1" />

                                                    <TextBlock Text="NAIP:"
                                                               Grid.Row="1"
                                                               Grid.Column="0" />
                                                    <TextBlock Text="{Binding SelectedBuildingObject.HasNaip}"
                                                               Grid.Row="1"
                                                               Grid.Column="1" />

                                                    <TextBlock Text="Poznámka:"
                                                               Grid.Row="2"
                                                               Grid.Column="0" />
                                                    <TextBlock Text="{Binding SelectedBuildingObject.Notes, FallbackValue='(bez poznámky)'}"
                                                               Grid.Row="2"
                                                               Grid.Column="1"
                                                               Style="{StaticResource WrappingTextBlock}" />
                                                </Grid>
                                            </StackPanel>

                                            <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                                                <TextBlock Text="Plochy a zkoušky" Style="{StaticResource IcbdSubheaderText}" />
                                                <Grid ColumnSpacing="{StaticResource IcbdSpacingMedium}"
                                                      RowSpacing="{StaticResource IcbdSpacingSmall}">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                    </Grid.RowDefinitions>

                                                    <TextBlock Text="Mostovka (BoQ):"
                                                               Grid.Row="0"
                                                               Grid.Column="0" />
                                                    <TextBlock Text="{Binding SelectedBuildingObject.DeckAreaBoq}"
                                                               Grid.Row="0"
                                                               Grid.Column="1" />

                                                    <TextBlock Text="Římsy (BoQ):"
                                                               Grid.Row="1"
                                                               Grid.Column="0" />
                                                    <TextBlock Text="{Binding SelectedBuildingObject.RailingAreaBoq}"
                                                               Grid.Row="1"
                                                               Grid.Column="1" />

                                                    <TextBlock Text="Ostatní (BoQ):"
                                                               Grid.Row="2"
                                                               Grid.Column="0" />
                                                    <TextBlock Text="{Binding SelectedBuildingObject.OtherAreaBoq}"
                                                               Grid.Row="2"
                                                               Grid.Column="1" />
                                                </Grid>

                                                <Grid ColumnSpacing="{StaticResource IcbdSpacingMedium}"
                                                      RowSpacing="{StaticResource IcbdSpacingSmall}">
                                                    <Grid.ColumnDefinitions>
                                                        <ColumnDefinition Width="Auto" />
                                                        <ColumnDefinition Width="*" />
                                                    </Grid.ColumnDefinitions>
                                                    <Grid.RowDefinitions>
                                                        <RowDefinition Height="Auto" />
                                                        <RowDefinition Height="Auto" />
                                                    </Grid.RowDefinitions>

                                                    <TextBlock Text="Požadované zkoušky:"
                                                               Grid.Row="0"
                                                               Grid.Column="0" />
                                                    <TextBlock Text="{Binding SelectedBuildingObject.RequiredTestCount}"
                                                               Grid.Row="0"
                                                               Grid.Column="1" />

                                                    <TextBlock Text="Provedené zkoušky:"
                                                               Grid.Row="1"
                                                               Grid.Column="0" />
                                                    <TextBlock Text="{Binding SelectedBuildingObject.PerformedTestCount}"
                                                               Grid.Row="1"
                                                               Grid.Column="1" />
                                                </Grid>
                                            </StackPanel>

                                            <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                                                <TextBlock Text="Nesoulad v podkladech" Style="{StaticResource IcbdSubheaderText}" />
                                                <TextBlock Text="{Binding SelectedBuildingObject.HasBoqDiscrepancy, FallbackValue='Nezjištěn'}" Style="{StaticResource IcbdBodyTextBlockStyle}" />
                                                <TextBlock Text="{Binding SelectedBuildingObject.BoqVsRealDifferenceNote, FallbackValue='(bez zaznamenaného nesouladu v podkladech)'}"
                                                           Style="{StaticResource WrappingTextBlock}" />
                                            </StackPanel>
                                        </StackPanel>

                                        <!-- Edit detail -->
                                        <Grid Visibility="{Binding IsEditing, Converter={StaticResource BooleanToVisibilityConverter}}">
                                            <Grid.RowDefinitions>
                                                <RowDefinition Height="Auto" />
                                                <RowDefinition Height="*" />
                                            </Grid.RowDefinitions>

                                            <TextBlock Grid.Row="0"
                                                       Text="Upravit stavební objekt"
                                                       Style="{StaticResource DetailSectionHeader}" />

                                            <StackPanel Grid.Row="1"
                                                        Spacing="{StaticResource IcbdSpacingMedium}">
                                                <StackPanel Spacing="{StaticResource IcbdSpacingMedium}">
                                                    <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                                                        <TextBox Header="Kód"
                                                                 Text="{Binding EditableBuildingObject.Code, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        <TextBox Header="Název"
                                                                 Text="{Binding EditableBuildingObject.Name, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        <ComboBox Header="Typ konstrukce" ItemsSource="{Binding StructureTypes}"
                                                                  SelectedItem="{Binding EditableBuildingObject.StructureType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                            <!--<domain:BuildingStructureType>Unknown</domain:BuildingStructureType>
                                                            <domain:BuildingStructureType>Most</domain:BuildingStructureType>
                                                            <domain:BuildingStructureType>Propustek</domain:BuildingStructureType>
                                                            <domain:BuildingStructureType>Nadjezd</domain:BuildingStructureType>
                                                            <domain:BuildingStructureType>Jiné</domain:BuildingStructureType>-->
                                                        </ComboBox>
                                                        <ComboBox Header="Krytí" ItemsSource="{Binding CoverTypes}"
                                                                  SelectedItem="{Binding EditableBuildingObject.CoverType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                            <!--<domain:BuildingCoverType>Unknown</domain:BuildingCoverType>
                                                            <domain:BuildingCoverType>Přesypaný</domain:BuildingCoverType>
                                                            <domain:BuildingCoverType>Nepřesypaný</domain:BuildingCoverType>-->
                                                        </ComboBox>
                                                        <ComboBox Header="Stav"
                                                                  SelectedItem="{Binding EditableBuildingObject.Status, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}">
                                                            <domain:BuildingObjectStatus>Draft</domain:BuildingObjectStatus>
                                                            <domain:BuildingObjectStatus>Planned</domain:BuildingObjectStatus>
                                                            <domain:BuildingObjectStatus>InProgress</domain:BuildingObjectStatus>
                                                            <domain:BuildingObjectStatus>Completed</domain:BuildingObjectStatus>
                                                        </ComboBox>
                                                    </StackPanel>

                                                    <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                                                        <TextBlock Text="Izolace a technologie"
                                                                   Style="{StaticResource IcbdSubheaderText}"/>
                                                        <TextBox Header="Příprava"
                                                                 Text="{Binding EditableBuildingObject.PrepType, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        <ToggleSwitch Header="NAIP izolace"
                                                                      IsOn="{Binding EditableBuildingObject.HasNaip, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                      OnContent="Ano"
                                                                      OffContent="Ne" />
                                                        <TextBox Header="Poznámka"
                                                                 Text="{Binding EditableBuildingObject.Notes, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                 Style="{StaticResource MultilineTextBox}" />
                                                    </StackPanel>

                                                    <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                                                        <TextBlock Text="Plochy a zkoušky"
                                                                   Style="{StaticResource IcbdSubheaderText}"/>
                                                        <TextBox Header="Mostovka (BoQ)"
                                                                 Text="{Binding EditableBuildingObject.DeckAreaBoq, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        <TextBox Header="Římsy (BoQ)"
                                                                 Text="{Binding EditableBuildingObject.RailingAreaBoq, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        <TextBox Header="Ostatní (BoQ)"
                                                                 Text="{Binding EditableBuildingObject.OtherAreaBoq, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        <TextBox Header="Požadované zkoušky"
                                                                 Text="{Binding EditableBuildingObject.RequiredTestCount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                        <TextBox Header="Provedené zkoušky"
                                                                 Text="{Binding EditableBuildingObject.PerformedTestCount, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}" />
                                                    </StackPanel>

                                                    <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                                                        <TextBlock Text="Nesoulad v podkladech"
                                                                   Style="{StaticResource IcbdSubheaderText}"/>
                                                        <ToggleSwitch Header="Nesoulad"
                                                                      IsOn="{Binding EditableBuildingObject.HasBoqDiscrepancy, Mode=TwoWay}" />
                                                        <TextBox Header="Poznámka k nesouladu"
                                                                 Text="{Binding EditableBuildingObject.BoqVsRealDifferenceNote, Mode=TwoWay, UpdateSourceTrigger=PropertyChanged}"
                                                                 Style="{StaticResource MultilineTextBox}" />
                                                    </StackPanel>

                                                    <StackPanel Style="{StaticResource FormActionsPanel}">
                                                        <Button Content="Zrušit"
                                                                Command="{Binding CancelBuildingObjectEditCommand}" />
                                                        <Button Content="Uložit změny"
                                                                Command="{Binding SaveBuildingObjectEditCommand}" />
                                                    </StackPanel>
                                                </StackPanel>
                                            </StackPanel>
                                        </Grid>
                                    </Grid>
                                </Grid>
                            </Border>
                        </Grid>
                    </StackPanel>
                </ScrollViewer>

                <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                            <TextBlock Text="Výpočty a souhrny"
                                       Style="{StaticResource DetailSectionHeaderNoBottomMargin}" /> 
                            <TextBlock Text="Výpočty, souhrny a přehledy budou doplněny později."
                                       Style="{StaticResource IcbdBodyTextBlockStyle}" />
                        </StackPanel>
                        <StackPanel Spacing="{StaticResource IcbdSpacingSmall}">
                            <TextBlock Text="Poznámky a dokumentace"
                                       Style="{StaticResource DetailSectionHeaderNoBottomMargin}" />
                            <TextBlock Text="Poznámky, deník a dokumenty budou doplněny později."
                                       Style="{StaticResource IcbdBodyTextBlockStyle}" />
                        </StackPanel>
            </StackPanel>
        </Border>
        </ScrollViewer>
    </Grid>
</views:MenuPage>
